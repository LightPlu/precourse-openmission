# DDD 패턴을 적용하여 Refactoring 해보기

---

## Entity vs VO
- Entity : 가장 큰 특징은 식별자를 가진다는 것
    - 식별자 : Entity 객체마다 고유한 구분할 수 있는 기준
- VO : 개념적으로 완전한 하나를 표현할 수 있는 것
---
## 로또 프로젝트에서 어떻게 Entity와 VO를 구분해야 할까?

- 우선 Entity와 VO를 구분하기 전에 어떻게 프로젝트 구조를 가져갈지에 대해 말해보아야 한다.


- 현재 3주차 과제를 진행함에 있어 식별자를 가지는 Entity가 필요한가?
    - 3주차 과제에선 과거 로또 기록을 필요로 하지도 않고, 누가 샀는지에 대한 기록도 필요하지 않다
    - 단순히 금액을 입력하고, 해당 금액에 맞게 로또를 발행하고, 발행된 로또를 비교해서 당첨금을 계산하는 로직만 필요하다


- 그렇다면 식별자를 가지는 Entity와 VO를 구분하기 위해선 어떠한 전제조건이 필요한가?
    - 우선 식별자를 활용할 수 있도록 문제를 정의하는 것부터 시작해야 된다

---

## 로또에서는 어떤것이 식별자를 가지고, 어떠한 문제점이 존재할까?

- 식별자를 활용할 수 있도록 로또를 관련지어야 한다면 어떤 것이 존재할까?
    - 로또를 사봤거나 검색해보았다면 알 수 있겠지만 한 게임당 총 5번의 로또 번호를 추첨할 수 있다 (ex: [1,2,3,4,5,6], [7,8,9,10,11,12], ...)
    - 로또 한 게임은 영수증과 같이 종이로 보관되기 때문에 해당 게임의 식별자를 두어 각 게임별로 구분지을 수 있다
    - 현재 로또 게임에 대하여 검색해본다면 각 회차별 당첨금액이 4,5등을 제외하고 다 다르다. 이는 각 회차별 로또 구매 금액이 매번 다르기 때문이다. 왜 다른지는 검색을 해본다면 보다 자세히 알 수 있다
        - 이를 통해 각 회차별로도 식별자를 가져 회차별로 구분할 수 있게 해야함을 의미한다


- 그렇다면 어떠한 것들이 식별자를 가지는 것인지 정리해보자
    - 로또의 각 게임 식별자 (로또 5번당 영수증 1개, 이때 영수증이 게임을 의미)
    - 로또의 각 회차 (로또에는 각 회차마다 등수별 몇명 당첨되었는지, 당첨금은 얼마인지에 대해 설명한다)


- 왜 로또는 개인정보를 활용해서 로또 구매에 대하여 저장해두지 않아서 실물 로또 분실시 당첨금을 수령할 수 없는 문제점을 아직도 해결하지 못하였는가?
    - 개인적인 생각으로 개인정보를 활용하여 구매한 로또에 대하여 구매 정보를 저장해두면 좋지 않을까 생각을 하고 인터넷 검색을 해보았더니 이미 2023년에 동행복권 웹사이트 해킹사건이 존재했다.
    - 이는 이미 보안적으로 철저하게 관리한다고 해도 해킹은 발생할 수 있고, 언제든 개인정보 유출에 의한 위험 가능성이 존재한다는 것을 의미한다.
    - 만약 실물 로또에 개인정보를 추가하여 저장해둔다 하더라도 개인정보를 저장하고 있는 서비스가 해킹을 통하여 공격당한다면 여전히 피해를 입을 가능성이 존재한다.
    - 이처럼 인터넷 복권의 필요성을 느껴 인터넷 서비스는 개발하되, 기존 실물 복권은 사람들의 수요가 존재하고 접근성이 편한 장점때문에 아직까지 로또 분실의 책임을 사람들에게 남겨두고 실물 복권을 유지하고 있다고 생각한다.

---

## 그렇다면 식별자를 가지는 Entity와 하나를 표현하는 VO를 가지는 로또 프로젝트를 구현한다면 어떠한 것들로 나눌 수 있을까?
### 현재 3주차 과제에서는 각 회차별로 저장할 필요가 없어 사실 모든 것을 VO로 둬도 상관 없다고 생각한다. 한번 정해지면 바뀌는 것이 없기 때문이다. 하지만 이번 오픈미션에선 DDD 패턴에 대해 학습한 것을 적용하기 위한 리팩토링을 진행하기 때문에 상황을 가정하는 것부터 시작해야한다.

---

##  Entity를 두기 위하여 문제 정의를 가정해보겠다
- 각 로또를 실물 로또를 통하여 구분해야 한다.
- 각 회차별로 당첨 내역 및 당첨번호를 제공해야 한다

---

## Entity 및 VO

- 식별자로 인해 구분해야 하는 것(Entity)
    - Round(로또게임의 각 회차)[Aggregate Root]
        - 로또의 각 회차를 관리한다.
    - LottoTicket(로또의 각 게임)[Aggregate Root]
        - 각 게임에는 최소 1개, 최대 5개의 로또 추첨이 들어갈 수 있다
    - LottoResult(로또의 각 회차)
        - 각 회차별 등수마다 몇개의 당첨이 존재하고, 당첨금액은 얼마인지에 대해 표현한다.
    - WinningLottoNumbers(로또의 각 당첨번호)
        - 각 회차별 당첨번호는 어떻게 되는지에 대해 저장해둔다.
        - 각 회차별로 당첨금액처럼 저장만 해두면 되지 굳이 Entity로 정해야하나?
            - 확률적으로 가능할 진 모르겠지만 당첨번호를 보고 수동으로 로또 번호를 추첨하는 사람이 있을 수 있다. 그런 사람들을 위해 당첨번호만 조회할 수 있도록 따로 저장해두면 좋다고 생각된다.



- VO로 구분할 수 있는 것
    - Lotto(각 로또 1번 구매[1000원])
    - Cash(로또 금액)
    - Rank(등수)
    - LottoNumber(로또 번호)
    - CountResult(각 로또별 번호가 몇개 맞았는지에 대한 VO)
    - RoundResult(각 등수별 결과)
    - WinningLottoNumber(당첨 번호)

---

## Use case
### Use case : 사용자가 애플리케이션을 통해 하고자 하는 "행동(목적)"을 표현한 것

- Round 관련 Use case
    - 모든 회차 조회
    - 회차 종료시 새로운 회차 자동 시작
    - 특정 회차 LottoTicket들과 당첨 번호를 비교


- Ticket 관련 Use case
    - Lotto Ticket 발행


- WinningLottoNumber 관련 Use case
    - 당첨 번호 등록
    - 특정 회차 당첨 번호 조회


- Round Result 관련 Use case
    - Round Result 저장
    - 특정 회차 결과 조회


- Round 종료 및 그 다음 회차 시작 Use case[제일 중요한 Use case]
    - 1. roundNumber로 한 회차의 모든 Ticket 조회
    - 2. roundNumber로 해당 회차의 당첨 번호 조회
    - 3. 로또 티켓 비교 로직을 통해 모든 Ticket 비교
    - 4. 회차 결과를 다루는 RoundResult 저장
    - 5. 다음 회차 자동 시작
